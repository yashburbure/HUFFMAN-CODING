Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 Stack Overflow
About
Products
For Teams
Search…
Join Stack Overflow to find the best answer to your technical question, help others answer theirs.

Home
PUBLIC
Questions
Tags
Users
Companies
COLLECTIVES
Explore Collectives
TEAMS
Stack Overflow for Teams – Start collaborating and sharing organizational knowledge. 
C program not writing to text file
Asked 6 years, 8 months ago
Modified 6 years, 8 months ago
Viewed 10k times

0


So here is the problem:

I want to write some text to a text file, but I got across some weird situations:

SAMPLE 1:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
In this version of the program, nothing ever gets written to the text file & I can't understand why. But the strangest thing for me is next:

SAMPLE 2:
int main()
{
    FILE *file = fopen("structures.txt", "a+"); // open the file for reading & writing
    int choice = 0;

    if(file == NULL)
        puts("Unable to open text file");
    else { 
        do {
            scanf("%d", &choice);
            fprintf(file, "This is testing for fprintf...\n");
            fclose(file); // Added this line, the writing works
        }while(choice > 0);
    }
    fclose(file);

    return 0;
}
After adding fclose(file); directly after the fprintf call, the program successfully writes :

This is testing for fprintf...

to the text file.

My questions are:

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

Does fclose() has anything to do with the writing process ?

What are the factors that prevent fprintf() from working ? (1st sample)

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

c
text-files
Share
Follow
asked Nov 17, 2015 at 18:02
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
1
In the first snippet, try replacing fprintf with printf. Will it work with the same input (btw, what is it?)? – 
Eugene Sh.
 Nov 17, 2015 at 18:06 
I did, but nothing is printed to the console. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:07
So the problem with your input. Debug it. Nothing to do with file IO – 
Eugene Sh.
 Nov 17, 2015 at 18:07 
I type in regular integers (1, 2, 5). I debugged, & I couldn't see anything that mattered. – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:09
1
Perhaps then it is time to go away for 5 minutes, come back, delete all the old files, compile and try again. – 
Weather Vane
 Nov 17, 2015 at 18:13 
Show 6 more comments
2 Answers
Sorted by:

Highest score (default)

3

Does that mean that I have to open my text file whenever I want to write some text to it & close it directly afterwards ?

No, but it may mean you need to close the file before the contents you've written will actually be flushed and written out to the file.

Does fclose() has anything to do with the writing process ?

Most file streams are buffered. Meaning that each write goes to memory. It is not written to disk until the buffer is full or you call close.

What are the factors that prevent fprintf() from working ? (1st sample)

Anything you get significantly wrong.

How can I open & close the text file just ONCE, at the start of the program & at the end of it (respectively) guaranteeing at the same time that my program will work flawlessly ?

You could call something like fflush(). But are you sure you tried this and the file contained nothing even after you finally closed the file at the end?

Share
Follow
edited Nov 17, 2015 at 18:14
answered Nov 17, 2015 at 18:07
user avatar
Jonathan Wood
62.2k6666 gold badges250250 silver badges421421 bronze badges
Should I empty the text file & USE flush() or just empty it ? – 
Mohammed Aouf Zouag
 Nov 17, 2015 at 18:10
Typo: it is fflush with two letters f – 
Basile Starynkevitch
 Nov 17, 2015 at 18:12
Thanks for the correction. Not sure what you mean by empty the text file. Either way, run the program as is to completion. Are you sure the file is still empty after it terminates? – 
Jonathan Wood
 Nov 17, 2015 at 18:15
Add a comment

1

I solved the problem using int fflush (FILE *stream) (which @Jonathan hinted at).

Flushing output on a buffered stream means transmitting all accumulated characters to the file. There are many circumstances when buffered output on a stream is flushed automatically:

When you try to do output and the output buffer is full.

When the stream is closed.

When the program terminates by calling exit.

When a newline is written, if the stream is line buffered.

Whenever an input operation on any stream actually reads data from its file.

So basically, I just had to call fflush() after the call to fprintf() :

fprintf(file, "This is testing for fprintf...\n");
fflush(file);
Share
Follow
answered Nov 17, 2015 at 18:26
user avatar
Mohammed Aouf Zouag
16.8k33 gold badges3939 silver badges6666 bronze badges
Add a comment
Your Answer
Sign up or log in
Post as a guest
Name
Email
Required, but never shown

By clicking “Post Your Answer”, you agree to our terms of service, privacy policy and cookie policy

Not the answer you're looking for? Browse other questions tagged c text-files or ask your own question.
The Overflow Blog
Stack Exchange sites are getting prettier faster: Introducing Themes
Money that moves at the speed of information (Ep. 462)
Featured on Meta
Duplicated votes are being cleaned up
Announcing the Stacks Editor Beta release!
Trending: A new answer sorting option
Should we burninate the [options] tag?
32 people chatting
C
2 days ago - Kamiccolo
dbush: Jun 20 at 5:08
C++ Questions and Answers
Jul 11 at 6:22 - Jerry Coffin
Jerry Coffin: Jul 11 at 6:22
nwp: Jul 9 at 20:03
MangaD: Jul 9 at 19:35
PeterT: Jul 7 at 10:03
Vaillancourt: Jun 7 at 1:08
Cubbi: Mar 11 at 20:48
sideshowbarker
Related
1823
Why should text files end with a newline?
1224
How to get line count of a large file cheaply in Python?
777
How do I save a String to a text file using Java?
745
How to append text to an existing file in Java?
3223
Improve INSERT-per-second performance of SQLite
1
fopen two processes
47
Create a file if one doesn't exist - C
2
fprintf not writing to file, despite fclose()
279
What does opening a file actually do?
1
C Programming. Using fopen fclose for text file operations
Hot Network Questions
Universal Phonetic Alphabet
Is this buff to the Clairvoyance spell still the power of a 3rd-level spell?
How to use dried onion flakes as a substitute for fresh onion?
Health Issues at Open Mics
Do all homogeneous spaces have homogeneous compactifications?
Solve a Card Suit Puzzle
Book series about post alien invasion Earth being exploited
How can Machine Learning help “see” in higher dimensions?
Are there interesting applications of estimating the energy for generalizations of the Heisenberg model?
Convert Descriptive Notation to Algebraic Notation
Why can my power armor's magic lightweight fuel cells not be used for other things?
Symbol for difficulty?
Is there a Mathematica equivalent of Eq() in sympy
Trouble determining CR or difficulty for homebrew creatures
Extract Strings from Text
Every possible pairing
Is there a tool or script that can very quickly find duplicates by only comparing filesize and a small fraction of the file contents?
Backronymiser឵឵
Amiga multitasking - different resolutions for each program on screen dragging
Why is the US listed as a "flawed democracy" in the Democracy Index?
How can you go from Paris to l'Ile d'Yeu?
Handle a subordinate who gives priority to office extracurricular over the actual billable work
How to define functions of functions
When exactly are IMMEDIATE constraints checked and what exactly is a "statement" in Postgres?
 Question feed

STACK OVERFLOW
Questions
Help
PRODUCTS
Teams
Advertising
Collectives
Talent
COMPANY
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Cookie Settings
Cookie Policy
STACK EXCHANGE NETWORK
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2022 Stack Exchange Inc; user contributions licensed under cc by-sa. rev 2022.7.13.42580

 